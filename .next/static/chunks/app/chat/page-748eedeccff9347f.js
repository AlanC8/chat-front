(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{7668:function(e,t,s){Promise.resolve().then(s.bind(s,5195))},5195:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var r=s(7437),a=s(6463),n=s(2265),c=s(4999),l=e=>{let{setText:t,placeholder:s,className:a="",text:n,onChange:c,onFocus:l,onBlur:o,onTyping:i}=e;return c=e=>{t(e.target.value),i&&i()},(0,r.jsx)("textarea",{placeholder:s,className:"".concat("resize-none border-none focus:ring-0"," ").concat(a),value:n,onChange:c,onFocus:e=>{l&&l()},onBlur:e=>{o&&o()}})},o=s(3823),i=e=>{let{username:t}=e,[s,a]=(0,n.useState)(null),[i,u]=(0,n.useState)([]),[d,x]=(0,n.useState)(1),[m,h]=(0,n.useState)(null),[f,g]=(0,n.useState)(""),p=(0,n.useRef)(t),v=(0,n.useRef)(()=>{}),b=(0,n.useRef)(()=>{}),j=(0,n.useRef)(()=>{}),[y,N]=(0,n.useState)(!0);(0,n.useEffect)(()=>{p.current=t},[t]),(0,n.useEffect)(()=>{let e=(0,c.io)("http://localhost:3000");return e.on("connect",()=>{console.log("Connected to server"),setTimeout(()=>{e.emit("get-message"),N(!1)},1e3)}),e.on("init-message",e=>{Array.isArray(e)?(console.log("Init Received messages from server",e),u(e)):console.error("Invalid messages format received from server",e)}),e.on("chat-message",e=>{Array.isArray(e)?u(e):console.error("Invalid messages format received from server",e)}),e.on("clients-total",e=>{console.log("Clients-total: ".concat(e)),x(e)}),e.on("feedback-check",e=>{h(e)}),v.current=()=>{e.emit("feedback",p.current)},b.current=()=>{e.emit("feedback",p.current)},j.current=()=>{e.emit("feedback","")},a(e),()=>{e.disconnect()}},[]);let w=()=>{let e=(0,o.v4)();u([...i,{id:e,text:f,username:t,createdAt:new Date}]),s?(s.emit("send-message",{id:e,text:f,username:t,createdAt:new Date}),g("")):console.log("Socket is not connected")},k=(0,n.useRef)(null);return(0,n.useEffect)(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},[i]),(0,r.jsx)("div",{children:y?(0,r.jsxs)("div",{className:"h-[750px]",children:[" ",(0,r.jsx)("h1",{className:"text-center text-5xl text-white my-[300px]",children:"Загрузка сообщении..."})]}):(0,r.jsxs)("div",{className:"flex flex-col h-[750px] bg-white rounded-md",children:[(0,r.jsxs)("div",{className:"bg-white text-black px-6 py-4 rounded-t-md",children:[(0,r.jsx)("h1",{className:"text-center text-2xl",children:"Общий чат"}),(0,r.jsxs)("p",{className:"text-center opacity-[60%]",children:[" ",d," online"]})]}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{className:"flex-grow py-6 px-10 overflow-y-auto",ref:k,children:[i.map((e,s)=>e.username===t?(0,r.jsx)("div",{className:"flex-grow p-6 overflow-y-auto text-right",children:(0,r.jsx)("div",{className:"flex flex-col space-y-4",children:(0,r.jsxs)("div",{className:"bg-blue-500 text-white text-2xl p-3 rounded-lg self-end max-w-xs",children:[(0,r.jsx)("p",{className:"text-sm",children:e.username}),(0,r.jsx)("p",{className:"text-md",children:e.text}),(0,r.jsx)("p",{className:"text-sm",children:new Date(e.createdAt).toLocaleString()})]})})},s):(0,r.jsx)("div",{className:"flex-grow py-6 overflow-y-auto",children:(0,r.jsx)("div",{className:"flex flex-col space-y-4",children:(0,r.jsxs)("div",{className:"bg-slate-100 text-black text-2xl p-3 rounded-lg self-start max-w-xs",children:[(0,r.jsx)("p",{className:"text-sm",children:e.username}),(0,r.jsx)("p",{className:"text-md",children:e.text}),(0,r.jsx)("p",{className:"text-sm",children:new Date(e.createdAt).toLocaleString()})]})})},s)),m&&(0,r.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[m," is typing..."]})]}),(0,r.jsxs)("form",{className:"p-4 bg-white border-t border-gray-200 flex items-center rounded-b-lg",children:[(0,r.jsx)(l,{text:f,setText:g,placeholder:"Type your message...",onTyping:v.current,onBlur:j.current,onFocus:b.current,className:"flex-grow p-2 border border-gray-300 text-black rounded-md focus:outline-none focus:border-blue-500"}),(0,r.jsx)("button",{onClick:e=>{e.preventDefault(),w()},type:"submit",className:"ml-4 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600",children:"Send"})]})]})})},u=s(5428),d=()=>{let[e,t]=(0,n.useState)(null),s=(0,a.useRouter)(),c=async()=>{try{let e=await u.e.getUser();t(e.data.username)}catch(e){console.log(e)}};return(0,n.useEffect)(()=>{c()},[]),(0,r.jsxs)("div",{className:"bg-blue-500 text-white px-24 py-6",children:[(0,r.jsxs)("div",{className:"flex align-center justify-between ",children:[(0,r.jsxs)("div",{className:"flex justify-between w-[350px]",children:[(0,r.jsx)("h1",{children:"Online Chat"}),(0,r.jsx)("button",{className:"",onClick:()=>{localStorage.removeItem("access"),t(null),s.push("/")},children:"Выйти с дискуссии"})]}),null!==e?e:"No username found"]}),(0,r.jsx)(i,{username:e})]})}},5428:function(e,t,s){"use strict";s.d(t,{e:function(){return a}});var r=s(8472);class a{static async login(e,t,s){try{return await r.Z.post("http://localhost:3000/api/v1/login",{username:e,password:t,email:s})}catch(e){console.error("Error during login request:",e)}}static async getUser(){return await r.Z.get("http://localhost:3000/user",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("access"))}})}static async register(e,t,s){try{return await r.Z.post("http://localhost:3000/api/v1/register",{username:e,password:t,email:s})}catch(e){console.error("Error during register request:",e)}}}}},function(e){e.O(0,[236,86,971,23,744],function(){return e(e.s=7668)}),_N_E=e.O()}]);